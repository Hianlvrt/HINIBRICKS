// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Post {
    id        Int      @id @default(autoincrement())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model LegoOrder {
    id                     Int           @id @default(autoincrement())
    planType               String        // 'standard' o 'familiar'
    planName               String
    planPrice              Int
    totalPrice             Int
    extraAccessoriesCount  Int           @default(0)
    petId                  Int?          // ID de mascota si el cliente agregó una
    status                 String        @default("pending") // pending, confirmed, completed, cancelled
    backgroundId           Int           @default(1)
    customBackgroundUrl    String?       // URL en Cloudinary cuando backgroundId === 0 (fondo personalizado)
    customerName           String
    customerEmail          String
    customerPhone          String
    customerRut            String
    customerRegion         String
    customerComuna         String
    customerAddress        String?
    customerNote           String?
    createdAt              DateTime      @default(now())
    updatedAt              DateTime      @updatedAt
    
    figures                LegoFigure[]

    @@index([status])
    @@index([createdAt])
    @@index([customerEmail])
}

model LegoFigure {
    id          Int        @id @default(autoincrement())
    orderId     Int
    figureNumber Int       // 1, 2, 3, o 4
    hairId      Int
    faceId      Int
    bodyId      Int
    legsId      Int
    accessories String     // JSON array de IDs de accesorios
    createdAt   DateTime   @default(now())
    
    order       LegoOrder  @relation(fields: [orderId], references: [id], onDelete: Cascade)

    @@index([orderId])
}

// Inventario: ítems deshabilitados (se muestran pero no se pueden seleccionar)
model DisabledProduct {
    id     Int    @id @default(autoincrement())
    type   String // 'lego' | 'pet' | 'fondo'
    itemId Int
    @@unique([type, itemId])
    @@index([type])
}
